{"ast":null,"code":"import _objectSpread from \"/home/bd2-system/Desktop/esi/website-vuejs/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regeneratorRuntime from \"/home/bd2-system/Desktop/esi/website-vuejs/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/bd2-system/Desktop/esi/website-vuejs/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport { mapState, mapActions } from 'vuex';\nimport { formatDate } from '@/utils';\nexport default {\n  name: 'recent-activities',\n  components: {},\n  mounted: function mounted() {\n    var _this = this;\n    return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var threadsMap, codes;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _this.getMoneyUpdates();\n            _this.getPedidosUpdates();\n            _context.next = 4;\n            return _this.getCommentsUpdates();\n          case 4:\n            threadsMap = _this.threads.reduce(function (threads, curr) {\n              if (threads[curr.thread_name]) {\n                threads[curr.thread_name].push(curr);\n              } else {\n                var comments = [curr];\n                threads[curr.thread_name] = comments;\n              }\n              return threads;\n            }, {});\n            codes = Object.keys(threadsMap);\n            _this.getMultiPointInfo({\n              data: {\n                codes: codes\n              }\n            });\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }))();\n  },\n  computed: _objectSpread(_objectSpread({\n    activities: function activities() {\n      return this.pedidos.concat(this.money).concat(this.threads).sort(this.dateCompare);\n    }\n  }, mapState({\n    money: function money(state) {\n      return state.money.updates;\n    },\n    pedidos: function pedidos(state) {\n      return state.esic.updates;\n    },\n    threads: function threads(state) {\n      return state.comments.updates;\n    },\n    multiPontinfo: function multiPontinfo(state) {\n      return state.money.multiPontinfo;\n    }\n  })), {}, {\n    activitiesLoaded: function activitiesLoaded() {\n      return this.activities.slice(0, this.activitiesToShow);\n    }\n  }),\n  data: function data() {\n    return {\n      activitiesToShow: 5\n    };\n  },\n  methods: _objectSpread(_objectSpread({\n    formatDate: formatDate,\n    dateCompare: function dateCompare(a, b) {\n      return a.date < b.date ? 1 : -1;\n    },\n    getIcon: function getIcon(item) {\n      if (item.data) {\n        // Is a money update\n        var currState = item.event === 'modified' ? item.data.state[1] : item.data.state;\n        if (currState === 'empenhado') return this.$assets.aEmp;\n        if (currState === 'liquidado') return this.$assets.aLiq;\n        if (currState === 'orcado' || currState === 'atualizado') return this.$assets.aPla;\n      } else if (item.comments) {\n        // Is a comments update\n        if (item.comments.length > 4) return this.$assets.aComExtra;else return this.$assets.aCom;\n      } else if (item.pedido) {\n        // Is a pergunta update\n        return this.$assets.aPer;\n      }\n      return '';\n    },\n    routeDespesa: function routeDespesa(code) {\n      this.$router.push({\n        name: 'despesa',\n        params: {\n          code: code\n        }\n      });\n    }\n  }, mapActions(['getMoneyUpdates', 'getPedidosUpdates', 'getCommentsUpdates', 'getMultiPointInfo'])), {}, {\n    loadMore: function loadMore() {\n      if (this.activitiesToShow > this.activitiesLoaded.length) return;\n      this.activitiesToShow = this.activitiesToShow + 5;\n    }\n  })\n};","map":{"version":3,"names":["mapState","mapActions","formatDate","name","components","mounted","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","threadsMap","codes","wrap","_callee$","_context","prev","next","getMoneyUpdates","getPedidosUpdates","getCommentsUpdates","threads","reduce","curr","thread_name","push","comments","Object","keys","getMultiPointInfo","data","stop","computed","_objectSpread","activities","pedidos","concat","money","sort","dateCompare","state","updates","esic","multiPontinfo","activitiesLoaded","slice","activitiesToShow","methods","a","b","date","getIcon","item","currState","event","$assets","aEmp","aLiq","aPla","length","aComExtra","aCom","pedido","aPer","routeDespesa","code","$router","params","loadMore"],"sources":["src/components/RecentActivities.vue"],"sourcesContent":["<template>\n  <div class=\"activities\">\n    <h2 class=\"text-neutral-base text-3xl font-bold mb-3\">{{ $t('Recent Activities') }}</h2>\n    <p class=\"text-neutral-light text-xl mb-10\">\n      Acompanhe as últimas atividades da plataforma Cuidando do Meu Bairro\n    </p>\n    <ol class=\"relative border-l border-gray-200\">                  \n      <li class=\"mb-10 ml-4\" v-for=\"(activity, i) of activitiesLoaded\" :key=\"i\">\n          <div class=\"absolute w-6 h-6 bg-white rounded-full mt-0.5 -left-3 border border-white\">\n            <img :src=\"getIcon(activity)\">\n          </div>\n          <time class=\"text-sm font-normal leading-none text-gray-400\">{{ formatDate(activity.date) }}</time>\n          <span v-if=\"activity.comments\">\n            <h3 class=\"text-lg font-semibold text-neutral-base flex mt-2\">\n               Um novo comentário\n            </h3>\n            <p class=\"mb-4 text-base font-normal text-neutral-light\">\n              {{ $tc('comments_about', activity.comments.length, {count: activity.comments.length}) }}\n              {{ multiPontinfo[activity.thread_name]['ds_projeto_atividade'] }}\n            </p>\n            <a \n              class=\"inline-flex cursor-pointer items-center py-2 px-4 text-sm font-medium text-secondary-base bg-transparent rounded-lg border border-secondary-base hover:bg-secondary-base hover:text-white\"\n              @click=\"routeDespesa(activity.thread_name)\"\n            > Saiba mais \n              <svg class=\"ml-2 w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path fill-rule=\"evenodd\" d=\"M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z\" clip-rule=\"evenodd\"></path>\n              </svg>\n            </a>\n          </span>\n          <span v-if=\"activity.pedido\">\n            <h3 class=\"text-lg font-semibold text-neutral-base flex mt-2\">\n              Atualização de pedido de informação\n            </h3>\n            <p class=\"mb-4 text-base font-normal text-neutral-light\">\n              {{ activity.pedido.justification }}\n            </p>\n            <a \n              class=\"inline-flex cursor-pointer items-center py-2 px-4 text-sm font-medium text-secondary-base bg-transparent rounded-lg border border-secondary-base hover:bg-secondary-base hover:text-white\"\n              @click=\"routeDespesa(activity.code)\"\n            > Saiba mais \n              <svg class=\"ml-2 w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path fill-rule=\"evenodd\" d=\"M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z\" clip-rule=\"evenodd\"></path>\n              </svg>\n            </a>\n          </span>\n          <span v-if=\"activity.data\">\n            <div v-if=\"activity.event === 'modified'\">\n              <h3 class=\"text-lg font-semibold text-neutral-base flex mt-2\">\n                Uma despesa foi atualizada\n              </h3>\n              <p class=\"mb-4 text-base font-normal text-neutral-light\">\n                {{activity.description}} mudou de {{activity.data.state[0]}} para <b>{{activity.data.state[1]}}</b>\n              </p>\n              <a \n                class=\"inline-flex items-center cursor-pointer py-2 px-4 text-sm font-medium text-secondary-base bg-transparent rounded-lg border border-secondary-base hover:bg-secondary-base hover:text-white\"\n                @click=\"routeDespesa(activity.code)\"\n              > Saiba mais \n                <svg class=\"ml-2 w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                  <path fill-rule=\"evenodd\" d=\"M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z\" clip-rule=\"evenodd\"></path>\n                </svg>\n              </a>\n            </div>\n            <div v-if=\"activity.event === 'created'\">\n              <h3 class=\"text-lg font-semibold text-neutral-base flex mt-2\">\n                Uma nova despesa foi planejada\n              </h3>\n              <p class=\"mb-4 text-base font-normal text-neutral-light\">\n                {{activity.description}}\n              </p>\n              <a \n                class=\"inline-flex cursor-pointer items-center py-2 px-4 text-sm font-medium text-secondary-base bg-transparent rounded-lg border border-secondary-base hover:bg-secondary-base hover:text-white\"\n                @click=\"routeDespesa(activity.code)\"\n              > Saiba mais \n                <svg class=\"ml-2 w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                  <path fill-rule=\"evenodd\" d=\"M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z\" clip-rule=\"evenodd\"></path>\n                </svg>\n              </a>\n            </div>\n          </span>\n      </li>\n    </ol>\n    <button class=\"btn btn-color-sec inline-flex items-center text-right text-white px-3 py-2 cursor-pointer bg-secondary-light font-light hover:bg-secondary-base rounded\" @click=\"loadMore\">\n      Carregar mais\n      <svg class=\"w-4 h-4 dark:text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 14l-7 7m0 0l-7-7m7 7V3\"></path></svg>\n    </button>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapActions } from 'vuex'\nimport { formatDate } from '@/utils'\n\nexport default {\n  name: 'recent-activities',\n  components: {\n  },\n  async mounted () {\n    this.getMoneyUpdates()\n    this.getPedidosUpdates()\n    await this.getCommentsUpdates()\n    let threadsMap = this.threads.reduce((threads, curr) => {\n      if (threads[curr.thread_name]) {\n        threads[curr.thread_name].push(curr)\n      } else {\n        let comments = [curr]\n        threads[curr.thread_name] = comments\n      }\n      return threads\n    }, {})\n    let codes = Object.keys(threadsMap)\n    this.getMultiPointInfo({ data: { codes } })\n  },\n  computed: {\n    activities () {\n      return this.pedidos.concat(this.money).concat(this.threads).sort(this.dateCompare)\n    },\n    ...mapState({\n      money: state => state.money.updates,\n      pedidos: state => state.esic.updates,\n      threads: state => state.comments.updates,\n      multiPontinfo: state => state.money.multiPontinfo\n    }),\n    activitiesLoaded() {\n      return this.activities.slice(0, this.activitiesToShow);\n    },\n  },\n  data() {\n    return {\n      activitiesToShow: 5\n    };\n  },\n  methods: {\n    formatDate,\n    dateCompare (a, b) { return a.date < b.date ? 1 : -1 },\n    getIcon (item) {\n      if (item.data) {\n        // Is a money update\n        let currState = item.event === 'modified' ? item.data.state[1] : item.data.state\n        if (currState === 'empenhado') return this.$assets.aEmp\n        if (currState === 'liquidado') return this.$assets.aLiq\n        if (currState === 'orcado' || currState === 'atualizado') return this.$assets.aPla\n      } else if (item.comments) {\n        // Is a comments update\n        if (item.comments.length > 4) return this.$assets.aComExtra\n        else return this.$assets.aCom\n      } else if (item.pedido) {\n        // Is a pergunta update\n        return this.$assets.aPer\n      }\n      return ''\n    },\n    routeDespesa (code) {\n      this.$router.push({ name: 'despesa', params: { code } })\n    },\n    ...mapActions([\n      'getMoneyUpdates',\n      'getPedidosUpdates',\n      'getCommentsUpdates',\n      'getMultiPointInfo'\n    ]),\n    loadMore() {\n      if (this.activitiesToShow > this.activitiesLoaded.length) return;\n      this.activitiesToShow = this.activitiesToShow + 5;\n    }\n  }\n}\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}