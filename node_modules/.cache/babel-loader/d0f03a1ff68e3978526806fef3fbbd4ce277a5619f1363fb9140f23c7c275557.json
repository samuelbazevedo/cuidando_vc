{"ast":null,"code":"import _regeneratorRuntime from \"/home/bd2-system/Desktop/esi/website-vuejs/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _createForOfIteratorHelper from \"/home/bd2-system/Desktop/esi/website-vuejs/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _asyncToGenerator from \"/home/bd2-system/Desktop/esi/website-vuejs/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport Vue from 'vue';\nimport { baseUrls } from '@/configs';\nimport { http } from '@/utils';\nvar baseURL = baseUrls.subscriptions;\nexport default {\n  state: {\n    subscriptions: {},\n    pending: {\n      subscribe: {},\n      unsubscribe: {}\n    }\n  },\n  mutations: {\n    changePending: function changePending(state, _ref) {\n      var type = _ref.type,\n        id = _ref.id,\n        value = _ref.value;\n      Vue.set(state.pending[type], id, value);\n    },\n    setUserSubscriptions: function setUserSubscriptions(state, _ref2) {\n      var subscriptions = _ref2.subscriptions;\n      state.subscriptions = subscriptions;\n    }\n  },\n  actions: {\n    getSubscriptions: function getSubscriptions(_ref3) {\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var rootState, commit, url, data, response, subscriptions, _iterator, _step, s;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              rootState = _ref3.rootState, commit = _ref3.commit;\n              url = \"\".concat(baseURL, \"/subscriptions\");\n              data = {\n                // subscriber: rootState.route.params.viewingUser\n                subscriber: rootState.auth.username\n              };\n              _context.next = 5;\n              return http.post(url, data);\n            case 5:\n              response = _context.sent;\n              subscriptions = {};\n              _iterator = _createForOfIteratorHelper(response.data.subscriptions);\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  s = _step.value;\n                  subscriptions[s.tag] = s;\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n              return _context.abrupt(\"return\", commit('setUserSubscriptions', {\n                subscriptions: subscriptions\n              }));\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }))();\n    },\n    subscribe: function subscribe(_ref4, _ref5) {\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var rootState, commit, dispatch, author, tag, url, data;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              rootState = _ref4.rootState, commit = _ref4.commit, dispatch = _ref4.dispatch;\n              author = _ref5.author, tag = _ref5.tag;\n              url = \"\".concat(baseURL, \"/subscriptions\");\n              _context2.next = 5;\n              return dispatch('getMicroToken');\n            case 5:\n              _context2.t0 = _context2.sent;\n              _context2.t1 = [{\n                tag: tag,\n                author: author,\n                template_data: {\n                  link: window.location.href\n                }\n              }];\n              data = {\n                token: _context2.t0,\n                subscriptions: _context2.t1\n              };\n              commit('changePending', {\n                type: 'subscribe',\n                id: tag,\n                value: true\n              });\n              _context2.next = 11;\n              return http.put(url, data);\n            case 11:\n              commit('changePending', {\n                type: 'subscribe',\n                id: tag,\n                value: false\n              });\n              dispatch('getSubscriptions');\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }))();\n    },\n    unsubscribe: function unsubscribe(_ref6, _ref7) {\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var dispatch, commit, tag, url, data;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              dispatch = _ref6.dispatch, commit = _ref6.commit;\n              tag = _ref7.tag;\n              url = \"\".concat(baseURL, \"/subscriptions\");\n              _context3.next = 5;\n              return dispatch('getMicroToken');\n            case 5:\n              _context3.t0 = _context3.sent;\n              _context3.t1 = [tag];\n              data = {\n                token: _context3.t0,\n                tags: _context3.t1\n              };\n              commit('changePending', {\n                type: 'unsubscribe',\n                id: tag,\n                value: true\n              });\n              _context3.next = 11;\n              return http.delete(url, {\n                data: data\n              });\n            case 11:\n              commit('changePending', {\n                type: 'unsubscribe',\n                id: tag,\n                value: false\n              });\n              dispatch('getSubscriptions');\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }))();\n    }\n  }\n};","map":{"version":3,"names":["Vue","baseUrls","http","baseURL","subscriptions","state","pending","subscribe","unsubscribe","mutations","changePending","_ref","type","id","value","set","setUserSubscriptions","_ref2","actions","getSubscriptions","_ref3","_asyncToGenerator","_regeneratorRuntime","mark","_callee","rootState","commit","url","data","response","_iterator","_step","s","wrap","_callee$","_context","prev","next","concat","subscriber","auth","username","post","sent","_createForOfIteratorHelper","n","done","tag","err","e","f","abrupt","stop","_ref4","_ref5","_callee2","dispatch","author","_callee2$","_context2","t0","t1","template_data","link","window","location","href","token","put","_ref6","_ref7","_callee3","_callee3$","_context3","tags","delete"],"sources":["/home/bd2-system/Desktop/esi/website-vuejs/src/stores/subscriptions.js"],"sourcesContent":["import Vue from 'vue'\nimport { baseUrls } from '@/configs'\nimport { http } from '@/utils'\n\nconst baseURL = baseUrls.subscriptions\n\nexport default {\n  state: {\n    subscriptions: {},\n    pending: {\n      subscribe: {},\n      unsubscribe: {}\n    }\n  },\n  mutations: {\n    changePending (state, { type, id, value }) {\n      Vue.set(state.pending[type], id, value)\n    },\n    setUserSubscriptions (state, { subscriptions }) {\n      state.subscriptions = subscriptions\n    }\n  },\n  actions: {\n    async getSubscriptions ({ rootState, commit }) {\n      let url = `${baseURL}/subscriptions`\n      let data = {\n        // subscriber: rootState.route.params.viewingUser\n        subscriber: rootState.auth.username\n      }\n      let response = await http.post(url, data)\n      let subscriptions = {}\n      for (let s of response.data.subscriptions) {\n        subscriptions[s.tag] = s\n      }\n      return commit('setUserSubscriptions', { subscriptions })\n    },\n    async subscribe ({ rootState, commit, dispatch }, { author, tag }) {\n      let url = `${baseURL}/subscriptions`\n      let data = {\n        token: await dispatch('getMicroToken'),\n        subscriptions: [{\n          tag,\n          author,\n          template_data: { link: window.location.href }\n        }]\n      }\n      commit('changePending', { type: 'subscribe', id: tag, value: true })\n      await http.put(url, data)\n      commit('changePending', { type: 'subscribe', id: tag, value: false })\n      dispatch('getSubscriptions')\n    },\n    async unsubscribe ({ dispatch, commit }, { tag }) {\n      let url = `${baseURL}/subscriptions`\n      let data = {\n        token: await dispatch('getMicroToken'),\n        tags: [tag]\n      }\n      commit('changePending', { type: 'unsubscribe', id: tag, value: true })\n      await http.delete(url, { data })\n      commit('changePending', { type: 'unsubscribe', id: tag, value: false })\n      dispatch('getSubscriptions')\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}